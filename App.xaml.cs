using System;using System.IO;using System.Linq;using System.Text.Json;using System.Windows;using EnviadorPagosWPF.Models;
using QuestPDF.Infrastructure;namespace EnviadorPagosWPF;public partial class App:Application{public static AppConfig Config{get;private set;}=new();private static string? FindFile(params string[] names){string[] roots=new[]{AppContext.BaseDirectory,Directory.GetCurrentDirectory(),Path.GetDirectoryName(System.Diagnostics.Process.GetCurrentProcess().MainModule?.FileName??"")??""}.Where(p=>!string.IsNullOrWhiteSpace(p)).Distinct().ToArray();foreach(var root in roots)foreach(var name in names){var path=Path.Combine(root,name);if(File.Exists(path))return path;}return null;}protected override void OnStartup(StartupEventArgs e){base.OnStartup(e);
        // QuestPDF license configuration
        QuestPDF.Settings.License = LicenseType.Community;
try{var a=FindFile("appsettings.json");if(a!=null)Config=JsonSerializer.Deserialize<AppConfig>(File.ReadAllText(a))??new AppConfig();var s=FindFile("secrets.json");if(s!=null){var sec=JsonSerializer.Deserialize<AppConfig>(File.ReadAllText(s));if(sec!=null&&!string.IsNullOrWhiteSpace(sec.Smtp?.ApiKey))Config.Smtp.ApiKey=sec.Smtp.ApiKey;}}catch(Exception ex){MessageBox.Show("Error al leer configuraci√≥n: "+ex.Message,"Error",MessageBoxButton.OK,MessageBoxImage.Error);}}}
